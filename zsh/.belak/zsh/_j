#compdef j

typeset -A opt_args

_arguments -C \
	'1:cmd:->cmds' \
	'*:: :->args' \
	&& ret=0

case "$state" in
	cmds)
		local commands;
		commands=(
			"add:add a new link"
			"del:delete a link"
			"jump:jump to a link"
		)

		generators=()
		find -L "$HOME/.belak/j/" -not -iname '.keep' -type f | while read file
		do
			generators+=("$(basename "$file")")
		done

		_describe -t commands 'command' commands && ret=0
		_describe -t generators 'generator' generators && ret=0
		;;
	args)
		case $line[1] in
			"jump"|"del")
				generators=()
				find "$HOME/.belak/j/" -not -iname '.keep' -type l | while read file
				do
					generators+=("$(basename "$file")")
				done

				_describe -t generators 'generator' generators && ret=0
				;;
		esac
		;;
esac

return 1
